# Guide Wireshark 
* Autre logiciel à coupler : 
	* NetMiner : Scan le réseau avec informations sur chaques machines 
	* Snort : Analyse le trafic réseau en temps réel et détecte les activités suspectes en utilisant des règles prédéfinies ou personnalisées
	* Suricata : Pareil que Snort
	* Zeek : Compréhension du trafic réseau à haut niveau. Il génère des journaux détaillés sur les connexions réseau, les demandes et réponses HTTP, les requêtes DNS, et bien d'autres informations.
	* Security Onion

# I) Généralités
* Outil pour analyser le trafic réseau
* Permet d'identifier d'éventuelles activités suspectes.
* Permet d'analyser les trafics entrant et sortant sur une interface
* Capacité de filtrer les trafics par protocole, ip ou port
* Système de colorisation des paquets
* Système de statistiques et graphiques

# Filtrage de captures 
-   and - operator: ***and / &&***
-   or - operator: ***or / ||***
-   equals - operator: eq / == 
-   not equal - operator: ***ne / !=***
-   greater than - operator: ***gt /  >***
-   less than - operator: ***lt / <***
- Filtrage par IP : `ip.addr == <IP Address>`
- Filtrage par source & destination : `eth.dst == xx:xx:xx:xx:xx:xx`
- Filtrage par MAC : `ip.src == <SRC IP Address> and ip.dst == <DST IP Address>`
- Filtrage par protocole ou port : `tcp.port eq <Port #> or <Protocol Name>`

# Trafic ARP
* ARP est un protocole de couche 2 utilisé pour relier les adresses IP aux adresses MAC
* Types de messages ARP
	* Request : Who has @ip ? Tell @ip
		* Opcode indiques'il s'agit d'une requête ARP ou d'une réponse
			* 1 : Request
			* 2 : Reply
		* Target MAC address : Broadcast 
		* Sender MAC address 
		* Sender IP address
	* Reply : @ip is at @MAC
* Si il y a présence de requête ARP venant d'une IP inconnue c'est suspect 

# Trafic ICMP 
* ICMP est utilisé pour analyser divers nœuds sur un réseau.
* Souvent utilisé avec des utilitaires comme ping et traceroute.
* Types de messages ICMP 
	* Echo Request
		* Type : 8
	* Echo Reply
		* Type : 0

# Trafic TCP
* TCP gère la livraison des paquets, y compris la séquence et les erreurs.
* Attention au handshake (syn,synack,ack) qui sont interrompu via RST

# Trafic DNS
* Utilisé pour résoudre un nom en une IP
* 2 type de message
	* Query
	* Query reponse 
* Différents type 
	* SOA : Zone d'authorité
	* A : IPv4
	* AAAA : Ipv6
* 1 échange pour le meme but garde le même ID

# Comment détecter un scan d'un attaquant : 
1. ***Scan de port*** : Recherchez des paquets avec des drapeaux TCP SYN sans drapeaux ACK (filtre : `tcp.flags.syn == 1 and tcp.flags.ack == 0`). Les scans de ports sont souvent réalisés par des attaquants pour identifier les ports ouverts et les services vulnérables.
2. ***Scans ARP*** : Les attaquants peuvent également utiliser des scans ARP pour découvrir des hôtes actifs sur le réseau. Surveillez les requêtes ARP excessives (filtre : `arp.opcode == 1`).
    
3.  **Trafic ICMP** : Les outils de scan réseau tels que ping et nmap peuvent utiliser des paquets ICMP pour cartographier le réseau. Surveillez les paquets ICMP inhabituels ou excessifs (filtre : `icmp`).
    
4.  **DNS** : Les attaquants peuvent abuser du protocole DNS pour l'exfiltration de données, la communication de commandes et contrôle (C&C) ou le tunneling. Surveillez les requêtes et réponses DNS suspectes ou inhabituelles (filtre : `dns`).
    
5.  **Protocoles et ports non autorisés** : Surveillez les protocoles et les ports qui ne devraient pas être utilisés sur votre réseau. Par exemple, si vous n'utilisez pas le protocole SMB, vous pouvez filtrer le trafic SMB (filtre : `smb || smb2 || nbns`).
    
6.  **Connexions étranges ou inhabituelles** : Recherchez des connexions provenant d'adresses IP externes ou de pays inattendus, ou des connexions à des adresses IP ou des domaines suspects.


